require 'colorize'

ATTACH = '/Users/bob/Sites/new_ist_data/ist_data/cache/attach/NumRecipe'
NBVIEWER = 'https://nbviewer.org/github/daddygongon/jupyter_num_calc/blob/main/numerical_calc'

task :default do
  system 'rake -T'
end

desc 'mk_link all'
task :mk_link_all do
  puts "ATTACH = %s".blue % ATTACH
  puts "$nbview = %s".yellow % NBVIEWER
  ['./marked_pdfs/*.pdf', 'pdfs/*.pdf', 'ipynb_text/d*.ipynb',
   'report_ans/r*.ipynb'].each do |dir|
    target_files = Dir.glob(dir)
    target_files.each do |file|
      next if File.directory?(file)
      mk_link_target(file)
    end
  end
end
desc 'mk link and rsync with dir'
task :mk_link do
  file = ARGV[1]
  mk_link_target(file)
  exit
end

def mk_link_target(file)
  puts file.green
  basename = File.basename(file)
  target = File.join(ATTACH,basename)
  FileUtils.cp(file, target, verbose: true)
  if File.extname(file)=='.ipynb'
    print "| [[#{basename}][リンク]] ".cyan
    print "([[#{NBVIEWER}/#{file}][nbviewer]])\n".cyan
  else
    puts "[[#{basename}][テキスト]]"
  end
end
